"use strict";const MEUS_PLANIDS="MEUS PLANIDS",domain=window.location.host;let dashboard={user:{},aplicacoesDocentes:[MEUS_PLANIDS],aplicacaoSelecionada:"",janelaAplicacoesAberta:!1,csrfToken:document.querySelector("input[name=_csrf]").value,edicao:!1,system:new URLSearchParams(window.location.search).get("dashboard-system")},adicionarObjBtn=(a,e)=>`\n  <div class="adicionar-objeto-btn">     \n    <span class='text-shadow-inset ${e||""}'>${a}</span>\n  </div>\n`;const configsHTML=a=>`\n  <div class='dashboard-section__configuracoes__overlay overlay hidden opacidade-zero' data-fechar_configs='true'>\n    <div class='dashboard-section__configuracoes__wrapper'>  \n      <div class='dashboard-section__configuracoes__header'>\n        <h3>Configurações:</h3>   \n        <i class='fa fa-times fechar-janela-configuracoes' data-fechar_configs='true'></i>\n      </div> \n      <div class='dashboard-section__configuracoes__body formulario'>      \n        <div class='dashboard-section__configuracoes__editar-perfil-div'>\n          <div>\n            <i class='icone-editar-usuario fa fa-user'></i><p class='dashboard-section__configuracoes__editar-perfil'>Editar perfil</p>\n          </div>\n          <div>\n            <a href='/alterarsenha'><i class='icone-nova-senha fa fa-key'></i><p class='dashboard-section__configuracoes__nova-senha'>Alterar senha</p></a>\n          </div>\n        </div>\n        <div class='notificacoes-e-mensagens'>\n          <div title='notificações sobre o andamento de serviços solicitados.'>\n            <p>Notificações de serviços:</p>\n            <div>\n              <input type='checkbox' id='notificacoes-email' name='notifServicosEmail' ${a.notifServicos.email?"checked":""}>\n              <label for='notificacoes-email'>\n                <span></span>Receber notificações por e-mail              \n              </label>\n            </div>            \n          </div>\n          <div title='Mensagens gerais da Decania do CCS'>\n            <p>Mensagens gerais:</p>\n            <div>\n              <input type='checkbox' id='mensagens-email' name='mensagensGeraisEmail' ${a.mensagensGerais.email?"checked":""}>\n              <label for='mensagens-email'>\n                <span></span>Receber mensagens por e-mail              \n              </label>\n            </div>\n            <div>\n              <input type='checkbox' id='mensagens-site' name='mensagensGeraisSite' ${a.mensagensGerais.site?"checked":""}>\n              <label for='mensagens-site'>\n                <span></span>Receber mensagens em seu perfil do portal do CCS           \n              </label>\n            </div>\n          </div>\n        </div>\n          <div>\n            ${"docente"!==a.categoria?"\n              <button class='btn-deletar-perfil'>deletar perfil</button>\n              ":""}         \n          </div> \n      </div>\n    </div>\n  </div>\n`,telefonesString=a=>{let e="";for(let s=0;s<a.length;s++)e+=`<p class='dashboard-section__dados-funcionais__dado'><strong>${a[s].tipo}: </strong>${a[s].numero}</p>`;return e},recuperarContato=async()=>{const a=document.querySelector("input[name=userId]").value;dashboard.user=await variaveisGlobais.ajax("/users/recuperarContatoPorId","get",{id:a,populate:[{path:"planids",options:{sort:{semestre:-1}}},{path:"manutencao",options:{sort:{estado:1},select:"descricao identificacao estado"}},{path:"veiculo"}]})},iniciarAplicacao=async(a,e)=>{document.querySelector(".dashboard-section__aplicacoes-body").innerHTML="",document.querySelector(".dashboard-section__aplicacoes").classList.add("aberto"),document.getElementById(a.target.innerHTML).classList.add("selected"),dashboard.aplicacaoSelecionada=a.target.innerHTML,dashboard.janelaAplicacoesAberta=!0,await e()},transicaoAplicacoes=async(a,e)=>{document.querySelector(".dashboard-section__aplicacoes").classList.remove("aberto"),dashboard.aplicacaoSelecionada&&document.getElementById(dashboard.aplicacaoSelecionada).classList.remove("selected"),dashboard.janelaAplicacoesAberta&&a.target.innerHTML===dashboard.aplicacaoSelecionada?setTimeout(()=>{document.querySelector(".dashboard-section__aplicacoes-body").innerHTML="",dashboard.janelaAplicacoesAberta=!1,dashboard.aplicacaoSelecionada=""},400):await iniciarAplicacao(a,e)},abrirListaAplicacoes=a=>{if(!window.navigator.onLine)return variaveisGlobais.exibirMensagem("<h3>Não há conexão ativa entre dispositivo e a internet. Tente acessar os sistemas do CCS mais tarde. Se o problema persistir, entre em contato conosco</h3>",null,"Atenção!");if(a.target.classList.contains("aplicacao-item-lista"))switch(variaveisGlobais.scrollTo(".dashboard-section__aplicacoes-header",-100),a.target.innerHTML){case MEUS_PLANIDS:document.querySelector('script[src="/dist/scripts/planidUtils.min.js"]')?transicaoAplicacoes(a,rotinasPlanid):loadScript("/dist/scripts/planidUtils.min.js",()=>loadScript("/dist/scripts/dashboardPlanid.min.js",()=>transicaoAplicacoes(a,rotinasPlanid)))}},preencherAplicacoes=()=>{let a,e="<ul>";switch(dashboard.user.categoria){case"docente":a=[...dashboard.aplicacoesDocentes]}for(let s=0;s<a.length;s++)e+=`<li class='aplicacao-item-lista' id='${a[s]}'>${a[s]}</li>`;e+="</ul>",document.querySelector(".dashboard-section__aplicacoes-header").innerHTML=e},montarAplicacoes=()=>{preencherAplicacoes(),document.querySelector(".dashboard-section__aplicacoes-header").addEventListener("click",abrirListaAplicacoes)},preencherIdUsuario=()=>{let a;switch(dashboard.user.categoria){case"docente":a=`Professor ${dashboard.user.classe}`}const e=dashboard.user.foto?"\n    <hr>\n    <div class='dashboard-section__user-details__imagem-usuario-edicao-foto dashboard-section__user-details__remover-imagem'>\n      <i class='fa fa-times'></i>\n      <span>remover foto</span>\n    </div> ":"";document.querySelector(".dashboard-section__user-details").innerHTML=`\n    <div class='dashboard-section__user-details__container'>\n      <div class='dashboard-section__user-details__imagem-usuario-container'>\n        <div class='dashboard-section__user-details__imagem-usuario'>\n          <div class='dashboard-section__user-details__imagem-usuario-overlay ${dashboard.user.foto?"":"single"}'>\n            <div class='dashboard-section__user-details__imagem-usuario-edicao-foto dashboard-section__user-details__nova-imagem'>\n              <i class='fa fa-camera'></i>\n              <span>nova foto</span>\n            </div>\n            ${e}\n          </div>\n          ${dashboard.user.foto?`<img src='https://res.cloudinary.com/webdev-ccs/image/upload/${dashboard.user.foto}.jpg'>`:`<span class='dashboard-section__nome-usuario-inicial'>${textoCamelCase(dashboard.user.nome[0]).toUpperCase()}</span>`}\n        </div>\n      </div>\n      <div id='cropper' class='cropper opacidade-zero hidden'></div>\n      <p class='dashboard-section__user-details__nome-usuario'>${dashboard.user.nome}</p>\n      <p class='dashboard-section__user-details__categoria-usuario'>${a}</p>\n      <p class='dashboard-section__user-details__email-usuario'>${dashboard.user.email}</p>\n    </div>\n  `},preencherDadosFuncionais=()=>{const{user:a}=dashboard;let e="";"docente"!==a.categoria&&"tecnico"!==a.categoria||!a.unidadeLocalizacao||a.unidadeLotacao===a.unidadeLocalizacao?a.unidadeLotacao&&(e=`<p class='dashboard-section__dados-funcionais__dado'><span>Unidade:</span>${a.unidadeLotacao}</p>`):e=`\n      <p class='dashboard-section__dados-funcionais__dado'><span>Unidade de lotação:</span>${a.unidadeLotacao}</p>\n      <p class='dashboard-section__dados-funcionais__dado'><span>Unidade de localização:</span>${a.unidadeLocalizacao}</p>\n    `,document.querySelector(".dashboard-section__dados-gerais").innerHTML=`  \n  <div class='dashboard-section__ultimo-acesso'>Último acesso em ${moment(a.ultimoAcesso[1]).format("DD [de] MMMM [de] YYYY, [às] HH:mm")}h</div>\n  <div class='dashboard-section__dados-funcionais'>      \n    <h3 class='fonte-titulo'>Dados funcionais</h3>  \n    <div>\n      <i class='fa fa-cog dashboard-section__dados-funcionais__configuracoes'></i>\n      <span class='dashboard-section__dados-funcionais__configuracoes-texto'>configurações</span>\n    </div>  \n    <p class='dashboard-section__responsabilidade'>As informações aqui prestadas são de inteira responsabilidade do utilizador do portal do CCS e não são válidas para comprovação de vínculo com o Centro de Ciências da Saúde da UFRJ.</p>\n    ${e}\n    <p class='dashboard-section__dados-funcionais__dado'><span>Identificação:</span>${a.identificacao} (${a.tipoIdentificacao.toUpperCase()})</p>\n    ${a.titulacao?`<p class='dashboard-section__dados-funcionais__dado'><span>Titulação:</span> ${a.titulacao}</p>`:""}\n    ${a.setor?`<p class='dashboard-section__dados-funcionais__dado'><span>Setor:</span> ${a.setor}</p>`:""}\n    ${a.bloco?`<p class='dashboard-section__dados-funcionais__dado'><span>Bloco:</span> ${a.bloco}</p>`:""}\n    ${a.endereco?`<p class='dashboard-section__dados-funcionais__dado'><span>Endereço:</span> ${a.endereco}</p>`:""}\n    ${a.departamento?`<p class='dashboard-section__dados-funcionais__dado'><span>Departamento:</span>${a.departamento}</p>`:""}\n    ${a.classe?`<p class='dashboard-section__dados-funcionais__dado'><span>Classe:</span>${a.classe}</p>`:""}\n    ${a.regime?`<p class='dashboard-section__dados-funcionais__dado'><span>Regime:</span>${a.regime}</p>`:""}\n    ${a.vinculo?`<p class='dashboard-section__dados-funcionais__dado'><span>Vínculo:</span>${a.vinculo}</p>`:""}\n    ${a.cursoGrad?`<p class='dashboard-section__dados-funcionais__dado'><span>Curso:</span>${a.cursoGrad}</p>`:""}\n    ${a.cursoPG?`<p class='dashboard-section__dados-funcionais__dado'><span>Curso:</span>${a.cursoPG}</p>`:""}    \n    ${a.telefones?`<p class='dashboard-section__dados-funcionais__dado'><span>Telefones:</span></p> <div class='dashboard-section__telefones-div'>${telefonesString(a.telefones)}</div>`:""}\n  </div>`},editarPerfil=()=>{dashboard.edicao?rotinasEdicao():(loadScript("/dist/scripts/usersEdit.min.js",()=>{}),dashboard.edicao=!0)},cropperRoutines=a=>{document.getElementById("cropper").insertAdjacentHTML("beforeend","\n    <div class='button-div foto-usuario__button-div'>\n      <button class='foto-usuario-send btn-acao-confirmar'>enviar foto</button>\n      <button class='cancel btn-acao-cancelar'>cancelar</button>\n    </div>\n  "),document.querySelector(".foto-usuario__button-div").addEventListener("click",e=>{e.target.classList.contains("cancel")?(a.destroy(),variaveisGlobais.controlarVisibilidade("ocultar","#cropper"),setTimeout(()=>{document.getElementById("cropper").innerHTML="",variaveisGlobais.controlarVisibilidade("exibir",".dashboard-section__user-details__imagem-usuario-container")},600)):e.target.classList.contains("foto-usuario-send")&&a.result("blob").then(a=>{})})},initCropper=a=>{variaveisGlobais.controlarVisibilidade("ocultar",".form-nova-foto");const e=document.getElementById("cropper"),s=new Croppie(e,{viewport:{width:150,height:150,type:"circle"},boundary:{width:200,height:200},showZoomer:!0,enableOrientation:!0});s.bind({url:window.URL.createObjectURL(a.target.files[0])}),cropperRoutines(s)},rotinasNovaImagem=()=>{variaveisGlobais.controlarVisibilidade("ocultar",".dashboard-section__user-details__imagem-usuario-container"),document.getElementById("upload-foto")||(loadScript("/dist/scripts/croppie.min.js",()=>{}),loadScript("https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js",()=>{}),document.getElementById("cropper").insertAdjacentHTML("afterbegin",'\n      <form class=\'formulario form-nova-foto\'>   \n        <label>\n          <p>Selecionar arquivo:</p>\n        </label>    \n        <div class="anexo file-upload">   \n          <div style=\'width:100%; color: #cccccc;\'>\n            <label class="label-upload" for="upload-foto" id="label-upload-foto">\n                <i class="fa fa-upload manipular-arquivo"></i><span class="span-anexar">Anexar Arquivo</span>\n            </label>\n            <input type="file" name="anexo" id="upload-foto" class="anexo" required>\n          </div>         \n        </div> \n      </form>\n    '),variaveisGlobais.controlarVisibilidade("exibir","#cropper"),document.getElementById("upload-foto").addEventListener("change",initCropper))},fotoHandler=a=>{a.target.classList.contains("dashboard-section__user-details__nova-imagem")?(variaveisGlobais.controlarVisibilidade("ocultar",".dashboard-section__user-details__imagem-usuario-container"),document.getElementById("upload-foto")||(loadScript("/dist/scripts/croppie.min.js",()=>{}),loadScript("https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js",()=>{}),document.getElementById("cropper").insertAdjacentHTML("afterbegin",'\n      <form class=\'formulario form-nova-foto\'>   \n        <label>\n          <p>Selecionar arquivo:</p>\n        </label>    \n        <div class="anexo file-upload">   \n          <div style=\'width:100%; color: #cccccc;\'>\n            <label class="label-upload" for="upload-foto" id="label-upload-foto">\n                <i class="fa fa-upload manipular-arquivo"></i><span class="span-anexar">Anexar Arquivo</span>\n            </label>\n            <input type="file" name="anexo" id="upload-foto" class="anexo" required>\n          </div>         \n        </div> \n      </form>\n    '),variaveisGlobais.controlarVisibilidade("exibir","#cropper"),document.getElementById("upload-foto").addEventListener("change",initCropper))):a.target.classList.contains("dashboard-section__user-details__remover-imagem")&&(document.querySelector(".dashboard-section__user-details__container").innerHTML=`<img src='/img/loading.svg' alt='foto ${dashboard.user.nome}'>`)},definirOpcoesMensagem=a=>{let e;switch(a.target.name){case"notifServicosEmail":e="notifServicos.email";break;case"mensagensGeraisSite":e="mensagensGerais.site";break;case"mensagensGeraisEmail":e="mensagensGerais.email"}const s=JSON.stringify({[e]:a.target.checked});variaveisGlobais.ajax("/users/cadastro/editar-usuario","POST",{_csrf:dashboard.csrfToken,elements:s})},deletarPerfilHandler=a=>{if(a.target.classList.contains("btn-acao-cancelar")){operacaoDB(),variaveisGlobais.ajax("/signout","GET");const a=()=>{const a=`\n        <h3>${dashboard.user.nome.split(" ")[0]},</h3>\n        <p>Lamentamos sua partida! Caso resolva reativar seu antigo cadastro, basta realizar login em 90 dias contados a partir de hoje. Após este prazo, seu cadastro será excluído definitivamente. Por fim, pedimos que registre em nossa <a href='/fale-conosco'>central de atendimento</a> o motivo deste cancelamento.</p>\n        <p>Atenciosamente,</p>\n        <p>Assessoria de Desenvolvimento Web</p>\n        <p>Centro de Ciências da Saúde da UFRJ</p>\n        <div class='btn-div'>\n          <button class='retornar-pagina-principal'>Retornar ao Portal do CCS</button>\n        </div>\n      `;variaveisGlobais.exibirMensagem(a,null,"perfil excluído"),document.querySelector(".retornar-pagina-principal").addEventListener("click",()=>window.location.href="/")};variaveisGlobais.ajax("/users/cadastro/editar-usuario","POST",{_csrf:dashboard.csrfToken,elements:JSON.stringify({excluido:!0})},a)}else a.target.classList.contains("btn-acao-confirmar")&&variaveisGlobais.controlarVisibilidade("ocultar","#mensagens-genericas")},deletarPerfil=()=>{variaveisGlobais.exibirMensagem("\n    <h3>Tem certeza de que deseja excluir este perfil?</h3>    \n    <div class='btn-div eliminar-perfil'>\n      <button class='btn-acao-cancelar btn-apagar-perfil'>sim</button>\n      <button class='btn-acao-confirmar'>não</button>\n    </div>\n  ",null,"Atenção!"),document.querySelector(".eliminar-perfil").addEventListener("click",deletarPerfilHandler)},fecharJanelaConfigs=a=>{a.target.dataset.fechar_configs&&(variaveisGlobais.controlarVisibilidade("ocultar",".dashboard-section__configuracoes__overlay"),document.querySelectorAll("body")[0].classList.remove("fixed"))},listenersConfig=()=>{document.querySelector(".dashboard-section__configuracoes__editar-perfil").addEventListener("click",editarPerfil),document.querySelector(".notificacoes-e-mensagens").addEventListener("click",definirOpcoesMensagem),"docente"!==dashboard.user.categoria&&document.querySelector(".btn-deletar-perfil").addEventListener("click",deletarPerfil),document.querySelector(".dashboard-section__configuracoes__overlay").addEventListener("click",fecharJanelaConfigs)},dashboardConfigs=a=>{document.querySelectorAll("body")[0].classList.add("fixed"),document.querySelector(".wrapper").insertAdjacentHTML("afterbegin",configsHTML(dashboard.user)),variaveisGlobais.controlarVisibilidade("exibir",".dashboard-section__configuracoes__overlay"),document.querySelector(".dashboard-section__configuracoes__editar-perfil").addEventListener("click",editarPerfil),document.querySelector(".notificacoes-e-mensagens").addEventListener("click",definirOpcoesMensagem),"docente"!==dashboard.user.categoria&&document.querySelector(".btn-deletar-perfil").addEventListener("click",deletarPerfil),document.querySelector(".dashboard-section__configuracoes__overlay").addEventListener("click",fecharJanelaConfigs)},montarListenersDashboard=()=>{document.querySelector(".dashboard-section__user-details__imagem-usuario-overlay").addEventListener("click",fotoHandler),document.querySelector(".dashboard-section__dados-funcionais__configuracoes").addEventListener("click",dashboardConfigs)},preencherDadosGerais=()=>{preencherIdUsuario(),preencherDadosFuncionais(),document.querySelector(".dashboard-section__user-details__imagem-usuario-overlay").addEventListener("click",fotoHandler),document.querySelector(".dashboard-section__dados-funcionais__configuracoes").addEventListener("click",dashboardConfigs)},iniciarPrograma=async()=>{faultyBrowserHandler()||(await recuperarContato(),preencherIdUsuario(),preencherDadosFuncionais(),document.querySelector(".dashboard-section__user-details__imagem-usuario-overlay").addEventListener("click",fotoHandler),document.querySelector(".dashboard-section__dados-funcionais__configuracoes").addEventListener("click",dashboardConfigs),preencherAplicacoes(),document.querySelector(".dashboard-section__aplicacoes-header").addEventListener("click",abrirListaAplicacoes),dashboard.system&&setTimeout(()=>{document.getElementById(dashboard.system).click()},500))};document.addEventListener("DOMContentLoaded",iniciarPrograma);