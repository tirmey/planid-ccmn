"use strict";const urlParamsConsulta=new URLSearchParams(window.location.search),paramUnidade=urlParamsConsulta.get("unidade"),paramSemestre=urlParamsConsulta.get("semestre"),ajax=async({method:e,url:a,params:t={},callback:n})=>{let s;return await axios({method:e,url:a,params:t}).then(e=>{s=e,n&&n(e)}).catch(e=>{console.log("err: >>>>>> ",e)}),s},state={semestre:"",unidade:"",docentes:[],searchTerm:""},consultarPlanid=e=>{const a=e.target.dataset.id,t=e.target.dataset.unidade,n=e.target.dataset.semestre;if(t&&n){window.open(`/planids/print?${a?`_id=${a}`:""}&unidade=${t}&semestre=${n}`,"_blank").focus()}},gerarCorpoLista=e=>{let a=`\n    <h2>Clique sobre o nome do docente para visualizar, salvar ou imprimir o respectivo planid</h2>\n    <p class='planid-consulta-docentes__nome-unidade'>${state.unidade}</p>\n    <div class="planid-consulta-docentes__lista">`;if(e.length){for(let t=0;t<e.length;t++)a+=`<span data-id='${e[t].planids._id}' data-semestre='${state.semestre}' data-unidade='${state.unidade}'>${e[t].nome.toUpperCase()}</span>`;a+="</div>"}else a='<h2 class="nao-encontrados">Não foram encontrados planos de atividades que atendam aos critérios informados</h2>';e.length>1&&(a+=`\n      <div class='button-div'>\n        <button class="btn-base planid-consulta-docentes__imprimir-todos" data-unidade='${state.unidade}' data-semestre='${state.semestre}'>Imprimir todos</button>\n      </div>\n    `);const t=document.querySelector(".planid-consulta-docentes");t.innerHTML=a,t.addEventListener("click",consultarPlanid)},renderizarListaDocentes=async()=>{const e={$or:[{unidadePreenchimentoPlanid:"unidadeLotacao",unidadeLotacao:state.unidade},{unidadePreenchimentoPlanid:"unidadeLocalizacao",unidadeLocalizacao:state.unidade}]},a=(await ajax({url:"/planids/recuperar-docentes",method:"GET",params:{populate:{path:"planids"},query:e,semestre:state.semestre},callback:e=>{document.querySelector(".planid-consulta-filtros__form input[type=submit]").removeAttribute("disabled")}})).data;state.docentes=a,gerarCorpoLista(state.docentes)},renderizarInputBusca=()=>{let e;state.docentes.length>10?(e=`<input type='text' class='input-busca-docente' placeholder='pesquisar docentes pelo nome' value='${state.searchTerm}'>`,document.querySelector(".planid-consulta-filtros__input-busca").innerHTML=e,document.querySelector(".input-busca-docente").addEventListener("input",e=>{state.searchTerm=e.target.value,gerarCorpoLista(state.docentes.filter(a=>!e.target.value||removeDiacritics(a.nome.toUpperCase()).includes(removeDiacritics(e.target.value.toUpperCase()))))})):document.querySelector(".input-busca-docente")&&(document.querySelector(".input-busca-docente").outerHTML="")},listenerFiltros=async e=>{if(e.preventDefault(),state.unidade=e.target.elements.unidade.value,state.semestre=e.target.elements.semestre.value,!state.unidade||!state.semestre)return alert("É necessário informar Unidade e semestre para buscar planids");document.querySelector(".planid-consulta-filtros__form input[type=submit]").setAttribute("disabled",!0),state.searchTerm="",document.querySelector(".planid-consulta-docentes").innerHTML='<img class="loading-docentes" src="/img/loading.svg">',window.history.pushState(null,null,`consulta-publica?semestre=${state.semestre}&unidade=${state.unidade}`),await renderizarListaDocentes(),renderizarInputBusca()},checarParametros=()=>{paramUnidade&&arrayUnidades.includes(paramUnidade)&&paramSemestre?(state.unidade=paramUnidade,state.semestre=paramSemestre,document.querySelector(".selecao-semestre").value=state.semestre,document.querySelector(".selecao-unidade").value=state.unidade,document.querySelector(".planid-consulta-filtros__form input[type=submit]").click()):(paramUnidade&&!arrayUnidades.includes(paramUnidade)||paramUnidade&&!paramSemestre||paramSemestre&&!paramUnidade)&&setTimeout(()=>{alert("Não foram encontrados planos de atividades que atendam aos critérios informados")},500)},montarDivUnidades=()=>{const e=[...arrayUnidades];e.pop();let a="\n  <option value='' selected>Selecione uma Unidade:</option>\n  ";return a+=e.map(e=>`\n    <option value='${e}'>${e}</option>\n  `)},montarDivSemestres=()=>{const e=(new Date).getFullYear(),a=(new Date).getMonth()>6?2:1;let t="\n    <option value='' selected>Selecione um semestre:</option>\n    <option value='2019-2'>2019-2</option>\n  ";for(let a=2020;a<e-1;a++)t+=`\n    <option value='${e}-1'>${e}-1</option>\n    <option value='${e}-2'>${e}-2</option>\n    `;return t+=`<option value='${e}-1'>${e}-1</option>`,2===a&&(t+=`<option value='${e}-2'>${e}-2</option>`),t},rotinasConsultaPlanids=()=>{document.querySelector(".selecao-semestre").innerHTML=montarDivSemestres(),document.querySelector(".selecao-unidade").innerHTML=montarDivUnidades(),document.querySelector(".planid-consulta-filtros__form").addEventListener("submit",listenerFiltros),paramUnidade&&arrayUnidades.includes(paramUnidade)&&paramSemestre?(state.unidade=paramUnidade,state.semestre=paramSemestre,document.querySelector(".selecao-semestre").value=state.semestre,document.querySelector(".selecao-unidade").value=state.unidade,document.querySelector(".planid-consulta-filtros__form input[type=submit]").click()):(paramUnidade&&!arrayUnidades.includes(paramUnidade)||paramUnidade&&!paramSemestre||paramSemestre&&!paramUnidade)&&setTimeout(()=>{alert("Não foram encontrados planos de atividades que atendam aos critérios informados")},500)};window.addEventListener("DOMContentLoaded",rotinasConsultaPlanids);