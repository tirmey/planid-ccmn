const baseform=`\n  <div class='div-editar-usuario hidden opacidade-zero'>\n    <i class='fa fa-times-circle-o div-editar-usuario__fechar'></i>\n    <div class='div-editar-usuario__form-wrapper'>\n      <form class="formulario" id='user-form' method="POST" action="/users/cadastro/editar-usuario" novalidate>\n        <input type='hidden' name='_csrf' value=${dashboard.csrfToken}>\n        <h2>Editar perfil</h2>\n        <div>\n          <label for="user-nome">\n            <p>Nome completo:</p>\n          </label>\n          <input class='readonly' type="text" id="nome" name="nome" value='${dashboard.user.nome}' required readonly>\n        </div>\n        <div>\n          <label for="user-email">\n            <p>E-mail:</p>\n          </label>\n          <input type="email" id="email" name="email" value='${dashboard.user.email}' required>\n        </div>            \n        <div class="user-categoria">\n          <label for="user-categoria">\n            <p>Categoria:</p>\n          </label>\n          <select name='categoria' id='user-categoria'>\n            <option disabled selected>Selecione uma opção:</option>\n            <option value='estudante'>estudante</option>\n            <option value='docente'>docente</option>\n            <option value='tecnico'>técnico</option>\n            <option value='ufrj'>servidores de outros Centros / Reitoria</option>\n            <option value='posDoutorando'>pós-doutorando</option>\n            <option value='colaborador'>pesquisador-colaborador</option>\n            <option value='externo'>usuário dos serviços do CCS / outros</option>\n          </select>\n        </div>  \n        <div>\n          <input type="submit" class='btn-submit inativo' id='btn-submit' value="enviar">\n        </div>\n      </form>\n    </div>\n  </div>\n`,eliminarFormEdicao=e=>{(!e||e.target.classList.contains("div-editar-usuario")||e.target.classList.contains("div-editar-usuario__fechar"))&&(variaveisGlobais.controlarVisibilidade("ocultar",".div-editar-usuario"),setTimeout(()=>{document.querySelector(".div-editar-usuario").outerHTML=""},1e3))};document.querySelector(".wrapper").insertAdjacentHTML("afterbegin",baseform),variaveisGlobais.controlarVisibilidade("exibir",".div-editar-usuario"),document.querySelector(".div-editar-usuario").addEventListener("click",eliminarFormEdicao);const camposDesabilitados={todos:["nome","categoria","identificacao","unidadeLotacao","unidadeLocalizacao","unidadePreenchimentoPlanid"],estudante:["unidadeLotacao","nivelCurso","programaPG","cursoPG","cursoGrad"]},desabilitarCampos=()=>{for(let e=0;e<camposDesabilitados.todos.length;e++){const a=document.querySelector(`[name=${camposDesabilitados.todos[e]}]`);a&&(a.setAttribute("disabled",!0),a.setAttribute("readonly",!0),a.classList.add("readonly"))}if("estudante"===dashboard.user.categoria)for(let e=0;e<camposDesabilitados.estudante.length;e++){const a=document.querySelector(`[name=${camposDesabilitados.estudante[e]}]`);a&&(a.setAttribute("disabled",!0),a.setAttribute("readonly",!0),a.classList.add("readonly"))}document.querySelector("[name=senha]")&&(document.querySelector("[name=senha]").parentElement.outerHTML="")},prepararTelefonesSubmit=e=>{const a=[];if(e.telefones&&Array.isArray(e.telefones))for(let o=0;o<e.telefones.length;o++)a.push({tipo:e.telefonesTipo[o],numero:e.telefones[o]});else e.telefones&&a.push({tipo:e.telefonesTipo,numero:e.telefones});return a},prepararDadosEEnviar=e=>{const a=getFormElements(e,"string"),o=prepararTelefonesSubmit(a);delete a.telefonesTipo,delete a._csrf,a.telefones=o;const r=camposDesabilitados.todos;"estudante"===dashboard.user.categoria&&(r=[...camposDesabilitados.todos,...camposDesabilitados.estudante]);for(let e=0;e<r.length;e++)a[r[e]]&&delete a[r[e]];"undefined"!=typeof planid&&(planid.unidadePreenchimentoPlanid=dashboard.user[a.unidadePreenchimentoPlanid],arrayDisciplinas=[]);const i=a.email!==dashboard.user.email?a.email:void 0;variaveisGlobais.ajax("/users/cadastro/editar-usuario","POST",{_csrf:dashboard.csrfToken,novoEmail:i,elements:JSON.stringify(a)},e=>{const a=e.err||"Perfil atualizado. A interface será reiniciada...";variaveisGlobais.exibirMensagem(`<h3>${a}</h3>`,3e3,""),e.err||setTimeout(()=>{window.location.reload()},3e3)})},validarEdicaoForm=e=>{e.preventDefault();const a=document.querySelectorAll("#user-form input, #user-form select");if(document.getElementById("termo-ciencia").checked){checkEmptyInputs(a,200,40,document.querySelector(".div-editar-usuario__form-wrapper"))||(operacaoDB(),prepararDadosEEnviar(e))}else variaveisGlobais.exibirMensagem("<h3>Antes de enviar o formulário, você deve declarar ciência do teor do Termo de Veracidade</h3>",3500)},novoEmailHandler=e=>{e.target.value!==dashboard.user.email&&variaveisGlobais.exibirMensagem("\n      <h3>Certifique-se de que o novo e-mail é válido. Caso contrário, as menagens enviadas pela Decania do CCS não serão entregues.</h3>\n    ",null,"Atenção!")},prepararForm=()=>{document.querySelector(".div-editar-usuario")||(document.querySelector(".wrapper").insertAdjacentHTML("afterbegin",baseform),variaveisGlobais.controlarVisibilidade("exibir",".div-editar-usuario"));const e={target:{value:dashboard.user.categoria}};document.getElementById("user-categoria").querySelector(`option[value=${dashboard.user.categoria}]`).selected=!0,selecionarCategoria(e),document.querySelector(".div-editar-usuario")||listenersFormulario(),document.querySelector(".div-editar-usuario").addEventListener("click",eliminarFormEdicao),document.getElementById("email").addEventListener("blur",novoEmailHandler),document.getElementById("user-form").removeEventListener("submit",validacaoForm),document.getElementById("user-form").addEventListener("submit",validarEdicaoForm)},preencherTelefones=()=>{const{telefones:e}=dashboard.user;for(let a=0;a<e.length;a++)document.querySelector(".cadastrar-telefones").click(),document.getElementById(`telefones-user-tipo-${a}`).querySelector(`option[value=${e[a].tipo}]`).selected=!0,document.getElementById(`user-telefones-${a}`).value=e[a].numero},preencherForm=()=>{if(dashboard.user.telefones&&preencherTelefones(),dashboard.user.unidadeEstagio){document.getElementById("estagiario").checked=!0,definirEstagio({target:{checked:!0}})}if("estudante"===dashboard.user.categoria){document.querySelector("[name=nivelCurso]").querySelector(`option[value=${dashboard.user.nivelCurso}]`).selected=!0;const e={target:{value:dashboard.user.nivelCurso}};definirNivelCurso(e)}const e=Object.entries(dashboard.user);for(let a=0;a<e.length;a++)document.querySelector(`[name=${e[a][0]}]`)&&"telefones"!==e[a][0]&&(document.querySelector(`[name=${e[a][0]}]`).value=e[a][1])},rotinasEdicao=()=>{prepararForm(),preencherForm(),desabilitarCampos()};loadScript("/dist/scripts/users.min.js",()=>{prepararForm(),preencherForm(),desabilitarCampos()});