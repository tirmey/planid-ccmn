"use strict";const registroNovoPlanid=e=>{dashboard.user.planids=[e.sucesso,...dashboard.user.planids.filter(a=>a._id.toString()!==e.sucesso._id)]},cbEnviar=e=>{variaveisGlobais.exibirMensagem(`<h3>${e.err?e.err:"Plano de atividades enviado à Unidade Acadêmica."}</h3>`,4e3,e.err?"Erro":"Sucesso"),setTimeout(()=>{if(e.sucesso){if(planid.clicouFinalizar)return window.location.reload();planid.clicouFecharPlanid=!1,planid.clicouFinalizar=!1,registroNovoPlanid(e),fecharPlanid()}},4e3)},cbEditar=e=>{planid.autosaving?(planid.autosaving=!1,document.querySelector(".autosave-message")&&setTimeout(()=>{document.querySelector(".autosave-message").outerHTML=""},600)):variaveisGlobais.exibirMensagem(`<h3>${e.err?e.err:"Planid salvo.<br> Não esqueça de submetê-lo ao finalizar o registro das atividades."}</h3>`,e.err?2e3:3e3,e.err?"Erro":"Sucesso"),e.sucesso&&(registroNovoPlanid(e),planid.emEdicao=planid.clicouFecharPlanid?"":e.sucesso),planid.clicouFecharPlanid?rotinasPlanid():(clearInterval(planid.autoSaveInterval),planid.autoSaveInterval=setInterval(autoSave,planid.intervaloAutosave)),planid.clicouFecharPlanid=!1},cbErroSalvamento=e=>{variaveisGlobais.exibirMensagem('<h3>Não foi possível estabelecer conexão com o servidor, por conta de instabilidades da rede. Os dados foram salvos localmente. <a href="/" class="maiores-informacoes-rede">clique aqui</a> para maiores informações sobre como fazer para efetivar o envio dos dados salvos.</h3>'),document.querySelector(".maiores-informacoes-rede").addEventListener("click",e=>{e.preventDefault(),variaveisGlobais.exibirMensagem("\n      <p>Se a rede não estiver disponível em seu dispositivo ou em nossos servidores, não será possível concluir o salvamento dos dados do Planid CCS no banco de dados. No entanto, os dados salvos estão seguros na memória deste dispositivo.</p><p>Não recomendamos a utilização de outros dispositivos para o preenchimento do planid, até que os dados registrados localmente sejam salvos no banco de dados, sob o risco de perda de informações.</p><p>Esta janela, bem como o navegador utilizado para o preeenchimento de seu plano de atividades podem ser fechados a qualquer momento. Recomendamos que aguarde alguns instantes e clique, novamente, sobre os botões \"salvar\" ou \"enviar\".</p><p>Se, após algumas tentativas de salvamento, a conexão não for reestabelecida, tente atualizar seu navegador. Se, ainda asssim, persistir a mensagem de instabilidade na rede, sugerimos que entre em contato com o suporte do sistema, pelo email <a href='mailto:webdev@ccsdecania.ufrj.br'>webdev@ccsdecania.ufrj.br</a> ou pelo telefone <a href='tel:+552139380986'>3938-0986</a>.</p>\n    ")}),planid.semRede=!0,submeterPlanid()},rotinasNovoPlanid=e=>{selecionarDadosVersao(e),setTimeout(()=>{novoPlanid("novo")},300)},montarDivPendencias=e=>{document.querySelector(".div-pendencias")&&(document.querySelector(".div-pendencias").outerHTML="");let a="\n    <div class=\"div-pendencias\">\n      <div class='div-pendencias__window'>\n      \n        <div class='div-pendencias__header'>\n          <h3>campos não preenchidos:</h3>\n        </div>\n        <ul>\n  ";for(let i=0;i<e.length;i++)a+=`<li class='campo-vazio-${e[i].id}' data-campo='${e[i].id}' data-section='${e[i].dataset.section}' data-subsection='${e[i].dataset.subsection}'>${e[i].name}</li>`;return a+="</ul></div></div>"},submeterPlanid=e=>{const a=planid.emEdicao._id;let i,o=[];if(e?(e.preventDefault(),i=getFormElements(e,"array")):i=getFormElements(null,"array",document.getElementById("planid-formulario").elements),Array.isArray(i.comentariosGerais)&&(i.comentariosGerais=i.comentariosGerais[0]),planid.semRede){planid.semRede=!1,i.dataDeEdicao=(new Date).getTime();const e={idPlanid:a,_csrf:dashboard.csrfToken,finalizado:planid.clicouFinalizar,dados:JSON.stringify(i)};return clearInterval(planid.autoSaveInterval),planid.autosaving=!1,document.querySelector(".autosave-message")&&(document.querySelector(".autosave-message").outerHTML=""),localStorage.setItem("planidSalvo",JSON.stringify(e))}if(localStorage.removeItem("planidSalvo"),planid.clicouFinalizar){if("disciplina repetida"===(o=validarPlanid(i)))return variaveisGlobais.exibirMensagem("<h3>Há disciplinas com mesmo código e mesma natureza de participação. Os dados devem ser retificados, antes de submeter seu plano</h3>");if(o.length){const e=montarDivPendencias(o);document.querySelector(".overlay-novo-planid").insertAdjacentHTML("beforeend",e),document.querySelector(".div-pendencias").addEventListener("click",apontarInputVazio),document.querySelector(".alerta-nao-preenchidos").classList.add("active"),cbEnviar({err:"Todos os campos do planid devem ser preenchidos com dados válidos, antes de enviá-lo. Favor preencher ou remover os campos indicados."})}else{const e="\n        <div class='confirmar-submissao-planid'>\n          <h3>Confirmar a submissão deste planid?</h3>\n          <h3 class='subtitulo'>Certifique-se de ter informado todo o planejamento das atividades para o próximo semestre!</h3>\n          <h3 class='subtitulo'>Ao submeter o planid, você concorda com as seguintes condições:</h3>\n          <div class='condicoes-preenchimento-planid'>\n            <h3 class='condicoes-preenchimento-planid__condicao'>&bull; Fornecer informações verdadeiras e exatas.</h3>\n            <h3 class='condicoes-preenchimento-planid__condicao'>&bull; Aceitar que o usuário é o único responsável por toda e qualquer informação registrada em seu PLANID, estando sujeito às conseqüências, administrativas e legais, decorrentes de declarações falsas ou inexatas que vierem a causar prejuízos ao CCS, à UFRJ, à Administração Pública em geral ou a terceiros.</h3>\n          </div>\n          <div class='btn-div'>\n            <button class='btn-acao-cancelar'>Retornar</button>\n            <button class='btn-acao-confirmar'>Confirmar</button>\n          </div>\n        </div>\n      ";variaveisGlobais.exibirMensagem(e,null,"Confirmar submissão"),document.querySelector(".confirmar-submissao-planid").addEventListener("click",e=>{e.target.classList.contains("btn-acao-cancelar")?(variaveisGlobais.controlarVisibilidade("ocultar","#mensagens-genericas"),planid.clicouFinalizar=!1):e.target.classList.contains("btn-acao-confirmar")&&(operacaoDB(),variaveisGlobais.ajax("/users/planid/salvar","POST",{idPlanid:a,_csrf:dashboard.csrfToken,finalizado:planid.clicouFinalizar,dados:JSON.stringify(i)},cbEnviar,cbErroSalvamento))})}}else planid.autosaving||operacaoDB(),variaveisGlobais.ajax("/users/planid/salvar","POST",{idPlanid:a,_csrf:dashboard.csrfToken,finalizado:planid.clicouFinalizar,dados:JSON.stringify(i)},cbEditar,cbErroSalvamento)},exibirPlanidAposConexao=()=>{variaveisGlobais.exibirMensagem("\n    <h3>Conexão Restabelecida! Clique em 'OK' para reiniciar o navegador e continuar o preenchimento de seu planid</h3>\n    <div class='btn-div'>\n      <button class='btn-reiniciar-navegador'>OK</button>\n    </div>\n  "),document.getElementById("mensagens-genericas").addEventListener("click",()=>window.location.reload())},planidsClickHandler=e=>{if(!window.navigator.onLine)return variaveisGlobais.exibirMensagem("<h3>Sem acesso à internet. Avisaremos quando a conexão for restabelecida.</h3>"),window.addEventListener("online",exibirPlanidAposConexao);let a;if(e.target.dataset.id){const i=dashboard.user.planids.find(a=>a._id===e.target.dataset.id),o=`<h3>Prazo de preenchimento do planid ${a=i.semestre} encerrado.</h3>`;if(i.enviado&&a<semestre)return variaveisGlobais.exibirMensagem(o);if(!habilitarPreenchimentoPlanid)return variaveisGlobais.exibirMensagem(new Date<inicioPreenchimentoPlanid?`<h3>O planid ${a} poderá ser preenchido a partir de ${moment(inicioPreenchimentoPlanid).format("DD [de] MMMM [de] YYYY")}.</h3>`:o);selecionarDadosVersao(a),setTimeout(()=>{editarPlanid(e.target.dataset.id)},150),planid.autoSaveInterval=setInterval(autoSave,planid.intervaloAutosave)}else if(e.target.dataset.planid){if(!window.navigator.onLine)return variaveisGlobais.exibirMensagem('<h3>Sem acesso à internet. Para registrar comentários, abra o planid desejado e clique no ícone "Comentários Gerais", localizado no menu de ações.</h3>');if(a=dashboard.user.planids.find(a=>a._id===e.target.dataset.planid).semestre,!habilitarPreenchimentoPlanid)return variaveisGlobais.exibirMensagem("<h3>O prazo para edição dos comentários gerais deste planid já está encerrado</h3>");for(let a=0;a<dashboard.user.planids.length;a++)if(dashboard.user.planids[a]._id.toString()===e.target.dataset.planid){const e=dashboard.user.planids[a];comentariosGeraisHandler(e._id,e.semestre,e.comentariosGerais);break}}else if(e.target.dataset.imprimir)imprimirPlanid(e.target.dataset.imprimir,planid.unidadePreenchimentoPlanid,e.target.dataset.semestre,!0);else if(e.target.classList.contains("botao-novo-planid")){let e;e=prazoNovoPlanid&&!todosPlanidsEnviados()?"<h3>Não é possível iniciar o preenchimento de um novo planid sem o envio de todos os planos anteriores</h3>":prazoNovoPlanid?"<h3>Todos os seus planids foram enviados! Aguarde a divulgação do período para preenchimento de um novo planid.</h3>":"<h3>O prazo para o preenchimento de um novo planid está encerrado</h3>",planid.habilitarNovoPlanid?rotinasNovoPlanid(semestre):variaveisGlobais.exibirMensagem(e)}},editarPlanid=(e,a)=>{let i;e?i=dashboard.user.planids.find(a=>a._id===e):a&&(i=a),planid.emEdicao=i,novoPlanid("edicao"),preencherPlanid(i),fecharContainersAtividades()},iconeNaoPreenchidosHandler=()=>{document.querySelector(".div-pendencias.oculto")?document.querySelector(".div-pendencias").classList.remove("oculto"):document.querySelector(".div-pendencias").classList.add("oculto")},controlarExibicaoPendencias=()=>{const e=document.querySelector(".div-pendencias"),a=e.querySelectorAll("li");if(a.length){let e;for(let i=0;i<a.length;i++)if(+a[i].dataset.section===planid.pagina){e=!0;break}e||document.querySelector(".div-pendencias").classList.remove("oculto")}else e.outerHTML="",document.querySelector(".alerta-nao-preenchidos").classList.remove("active")},apontarInputVazio=e=>{if(e.target.dataset.section){document.querySelector(".div-pendencias").classList.add("oculto");const a=e.target,i=document.querySelector(`.${a.dataset.subsection}`);i.classList.contains("fechado")&&i.classList.remove("fechado"),planid.pagina!==Number(a.dataset.section)&&(variaveisGlobais.controlarVisibilidade("ocultar",`.section-${planid.pagina}`),planid.pagina=Number(a.dataset.section),navegacaoPlanid(!1,!0)),setTimeout(()=>{variaveisGlobais.scrollTo(i,0,null,".janela"),i.scrollTop=0},500),setTimeout(()=>{variaveisGlobais.scrollTo(document.getElementById(a.dataset.campo),-80,null,`.${a.dataset.subsection}`)},1e3)}},disciplinasDuplicadas=()=>{const e=document.querySelectorAll("input[name=disciplinaCodigo]"),a=document.querySelectorAll("select[name=disciplinaParticipacao]"),i={};for(let o=0;o<e.length;o++){if(i[`${e[o].value}${a[o].value}`])return!0;i[`${e[o].value}${a[o].value}`]=!0}return!1},validarPlanid=e=>{if(disciplinasDuplicadas())return"disciplina repetida";let a=[];const i=Object.entries(e);for(let e=0;e<i.length;e++){let o=i[e][0],n=i[e][1];for(let s=0;s<n.length;s++){const t="atividadesComplementaresEnsinoDescricao"===o||"atividadesComplementaresPesquisaDescricao"===o||"atividadesCoopIntDescricao"===o||"comentariosGerais"===o,r=!isNaN(+n[s])&&n[s]<0;if((!n[s]||"Selecione uma opção:"===n[s]||r)&&!t){document.querySelectorAll(`[name=${o}]`)[s].classList.add("campo-vazio"),a.push(document.querySelectorAll(`[name=${i[e][0]}]`)[s])}}}return a},checarCampoVazio=e=>{const a=e=>{e.required&&!e.value?e.classList.add("campo-vazio"):e.value&&(e.classList.remove("campo-vazio"),document.querySelector(`.campo-vazio-${e.id}`)&&(document.querySelector(`.campo-vazio-${e.id}`).outerHTML="",controlarExibicaoPendencias()))};e.keyCode&&9===e.keyCode?(a(planid.campoSelecionado),document.activeElement.type&&(planid.campoSelecionado=document.activeElement)):e.keyCode||(a(planid.campoSelecionado),e.target.type&&(planid.campoSelecionado=e.target))},navegacaoPlanid=(e,a)=>{let i,o,n;const s=e=>{variaveisGlobais.controlarVisibilidade("ocultar",`.section-${planid.pagina}`),"retornar"===e?planid.pagina--:e&&planid.pagina<planid.totalPaginas?planid.pagina++:e&&(planid.clicouFinalizar=!0,document.getElementById("submit-planid").click()),document.querySelector(".form-steps__step.selected").classList.remove("selected"),document.querySelector(`.step-section-${planid.pagina}`).classList.add("selected"),planid.pagina===planid.totalPaginas?(n="inativo",o="avançar"):(n="",o=planid.pagina<planid.totalPaginas?"avançar":"enviar"),i=1===planid.pagina?"inativo":"",setTimeout(()=>{variaveisGlobais.controlarVisibilidade("exibir",`.section-${planid.pagina}`)},500)};e&&e.target.classList.contains("btn-navegacao-planid")&&(variaveisGlobais.scrollTo(".planid-formulario-header",0,null,".overlay-novo-planid .janela"),e.target.classList.contains("btn-retornar")&&planid.pagina>0?s("retornar"):e.target.classList.contains("btn-avancar")&&planid.pagina<=planid.totalPaginas&&s("avancar")),(a||e.target.dataset.section)&&s(),(!e||e.target.classList.contains("btn-navegacao-planid")||e.target.dataset.section)&&(document.querySelector(".div-navegacao-planid").innerHTML=`\n      <div class=' btn-navegacao-planid btn-retornar ${i} oscilador-esquerda filhos-inativos'><i class='fa fa-caret-left ${i}'></i> retornar</div>\n      <div class=' btn-navegacao-planid btn-avancar oscilador-direita filhos-inativos ${n}'>${o} <i class='fa fa-caret-right'></i></div>\n    `)},stepsHandler=e=>{if(e.target.dataset.section){const a=Number(e.target.dataset.section);planid.pagina!==a&&(variaveisGlobais.controlarVisibilidade("ocultar",`.section-${planid.pagina}`),planid.pagina=a,navegacaoPlanid(e))}},deveSalvarPlanidAoFechar=()=>{localStorage.getItem("planidSalvo")?fecharPlanid():(variaveisGlobais.exibirMensagem("\n      <h3>Deseja salvar o planid antes de fechá-lo?</h3>\n      <div class='button-div mensagem-fechar-planid'>\n        <button class='salvar-sim'>SIM</button>\n        <button class='salvar-nao'>NÃO</button>\n      </div>\n    "),document.querySelector(".mensagem-fechar-planid").addEventListener("click",e=>{e.target.classList.contains("salvar-sim")?fecharPlanid(!0):(fecharPlanid(),variaveisGlobais.controlarVisibilidade("ocultar","#mensagens-genericas"))}))},fecharPlanid=e=>{e&&(planid.clicouFecharPlanid=!0,document.getElementById("submit-planid").click()),variaveisGlobais.controlarVisibilidade("ocultar",".overlay-novo-planid",!0),document.querySelectorAll("body")[0].classList.remove("fixo"),clearInterval(planid.autoSaveInterval),planid.pagina=1,planid.emEdicao="",rotinasPlanid(),planid.enviouPlano&&(planid.enviouPlano=!1)},salvarComentariosGerais=e=>{e.preventDefault();const a=()=>{variaveisGlobais.exibirMensagem("<h3>comentários salvos</h3>",1e3,"Sucesso!"),setTimeout(()=>variaveisGlobais.controlarVisibilidade("ocultar",".form-comentarios-gerais__overlay"),1e3)},i=e=>{planid.semRede=!0,document.getElementById("submit-planid").click(),variaveisGlobais.exibirMensagem("<h3>Sem acesso à internet. Os comentários foram salvos localmente.</h3>",2500,"Erro..."),setTimeout(()=>variaveisGlobais.controlarVisibilidade("ocultar",".form-comentarios-gerais__overlay"),1e3)};if(dashboard.user.planids.length||(document.querySelector("#planid-formulario input[name=comentariosGerais]").value=e.target.elements.comentariosGerais.value,a()),planid.emEdicao)planid.emEdicao.comentariosGerais=e.target.elements.comentariosGerais.value,document.querySelector("#planid-formulario input[name=comentariosGerais]").value=e.target.elements.comentariosGerais.value,window.navigator.onLine?a():i();else{if(!window.navigator.onLine)return variaveisGlobais.exibirMensagem('<h3>Sem acesso à internet. Para registrar comentários, abra o planid desejado e clique no ícone "Comentários Gerais", localizado no menu de ações.</h3>');const o=dashboard.user.planids;for(let n=0;n<o.length;n++)if(o[n]._id===e.target.dataset.id){o[n].comentariosGerais=e.target.elements.comentariosGerais.value,variaveisGlobais.ajax("/planids/editar-planid","POST",{_csrf:dashboard.csrfToken,data:JSON.stringify({_id:e.target.dataset.id,comentariosGerais:e.target.elements.comentariosGerais.value})},a,i),operacaoDB();break}}},comentariosGeraisHandler=(e,a,i)=>{document.querySelector("body").insertAdjacentHTML("beforeend",comentariosGerais(e,a,i||"")),variaveisGlobais.controlarVisibilidade("exibir",".form-comentarios-gerais__overlay"),document.querySelector(".form-comentarios-gerais .fa-times-circle").addEventListener("click",()=>{variaveisGlobais.controlarVisibilidade("ocultar",".form-comentarios-gerais__overlay"),setTimeout(()=>{document.querySelector(".form-comentarios-gerais__overlay").outerHTML=""},500)}),document.querySelector(".form-comentarios-gerais").addEventListener("submit",salvarComentariosGerais)},rotinasBtnAdicionar=e=>{e.target.parentElement.classList.contains("fechado")&&(e.target.parentElement.classList.remove("fechado"),e.target.parentElement.classList.remove("vazio")),e.target.parentElement.querySelector(".icone-abertura-container-atividade")||e.target.previousElementSibling.insertAdjacentHTML("afterbegin",caret)},fecharContainersAtividades=()=>{const e=document.querySelectorAll(".subsection-container");for(let a=0;a<e.length;a++)e[a].classList.add("fechado"),e[a].querySelector(".box-cinza")||e[a].classList.add("vazio"),e[a].scrollTop=0},rolarDivAtividades=e=>{setTimeout(()=>{const a=e.target.parentElement.offsetTop+100;$(".overlay-novo-planid .janela").animate({scrollTop:a},"slow")},700)},aberturaContainerAtividadesHandler=e=>{e.target.parentElement.classList.contains("fechado")&&fecharContainersAtividades(),e.target.parentElement.querySelectorAll(".box-cinza").length&&(e.target.parentElement.classList.toggle("fechado"),e.target.parentElement.scrollTop=0,rolarDivAtividades(e))},generalClickHandler=e=>{e.target.classList.contains("fa-times-circle")?(calcularCargaHorariaParcial(e),setTimeout(()=>{calcularCargaHorariaTotal()},600),1===e.target.parentElement.parentElement.parentElement.querySelectorAll(".box-cinza").length&&(e.target.parentElement.parentElement.parentElement.querySelector(".icone-abertura-container-atividade").outerHTML="",e.target.parentElement.parentElement.parentElement.classList.add("fechado"))):e.target.classList.contains("abrir-menu-acoes")?(e.target.classList.toggle("fa-bars"),e.target.classList.toggle("fa-times"),document.querySelector(".btn-submit-planid-div").classList.toggle("aberto")):e.target.classList.contains("comentarios-gerais")?comentariosGeraisHandler(planid.emEdicao._id,planid.emEdicao.semestre,planid.emEdicao.comentariosGerais):e.target.classList.contains("btn-acao")?rotinasBtnAdicionar(e):e.target.classList.contains("subsection-header")?aberturaContainerAtividadesHandler(e):e.target.classList.contains("wrapper-imprimir-planid-btn")?(document.getElementById("submit-planid").click(),setTimeout(()=>{const a=e.target.dataset.imprimir||planid.emEdicao._id;imprimirPlanid(a,planid.unidadePreenchimentoPlanid,e.target.dataset.semestre)},500)):e.target.classList.contains("icon-enviar-planid")?(planid.clicouFinalizar=!0,document.getElementById("submit-planid").click()):e.target.dataset.dica&&(variaveisGlobais.exibirMensagem(`<div class='texto-janela-dica'>${dicas[`${e.target.dataset.dica}_geral`]}<div>`,null,"orientações"),document.getElementById("mensagens-genericas").addEventListener("click",()=>{variaveisGlobais.controlarVisibilidade("ocultar","#mensagens-genericas",!0)}))},selecionarSecoesParaImportacao=e=>{const a=[],i=Object.entries(containers);for(let o=0;o<i.length;o++)for(let n=0;n<i[o][1].length;n++)!a.includes(i[o][0])&&e[i[o][1][n]].length&&a.push(i[o][0]);return a},listenerListasubsecoesImportarPlanid=(e,a)=>{e.preventDefault();const i=variaveisGlobais.getCheckedOrSelected(e.target.elements,"checkbox"),o={},n=Object.values(containers);for(let e=0;e<n.length;e++)for(let a=0;a<n[e].length;a++)o[n[e][a]]=[];const s="2"===planid.ultimoRegistrado.semestre.split("-")[1]?"1":"2",t="2"===planid.ultimoRegistrado.semestre.split("-")[1]?+planid.ultimoRegistrado.semestre.split("-")[0]+1:planid.ultimoRegistrado.semestre.split("-")[0];o.semestre=`${t}-${s}`;for(let e=0;e<i.length;e++){const n=i[e];for(let e=0;e<containers[n].length;e++)o[containers[n][e]]=a[containers[n][e]]}return editarPlanid(null,o),variaveisGlobais.controlarVisibilidade("ocultar","#mensagens-genericas")},controleMarcacaoSubsecoes=e=>{const a=document.querySelectorAll("#mensagens-genericas input[type=checkbox]");for(let i=0;i<a.length;i++)e.target.classList.contains("marcar-tudo")?a[i].checked=!0:a[i].checked=!1},opcoesParaImportacaoDOM=(e,a)=>{let i="";for(let a=0;a<e.length;a++)i+=`\n      <div>\n        <input type="checkbox" name="${e[a]}" id="${e[a]}" value="${e[a]}" checked>\n        <label for="${e[a]}"><span></span>${nomesAmigaveis[e[a]]}</label>        \n      </div>\n    `;const o=`\n    <div class='planids-importacao__marcar-div'>\n      <span class='marcar-tudo'>marcar todas</span>\n      <span class='desmarcar-tudo'>desmarcar todas</span>\n    </div>\n    <form class='planids-importacao__form formulario'>\n      <div>\n        ${i}\n      </div>      \n      <div>\n        <button>Importar subseções</button>\n      </div>\n    </form>\n  `;variaveisGlobais.exibirMensagem(o),document.getElementById("mensagens-genericas").addEventListener("submit",e=>listenerListasubsecoesImportarPlanid(e,a)),document.querySelector(".planids-importacao__marcar-div").addEventListener("click",controleMarcacaoSubsecoes)},importarPlanidHandler=e=>{if(e.target.classList.contains("sim")){const e=selecionarSecoesParaImportacao(planid.ultimoRegistrado);opcoesParaImportacaoDOM(e,JSON.parse(JSON.stringify(planid.ultimoRegistrado)))}else e.target.classList.contains("nao")&&(novoPlanid("edicao"),variaveisGlobais.controlarVisibilidade("ocultar","#mensagens-genericas"))},novoPlanid=e=>{"novo"===e&&planid.ultimoRegistrado?(variaveisGlobais.exibirMensagem(`\n      <h3>Deseja importar os dados do planid ${planid.ultimoRegistrado.semestre}?</h3>\n      <div class='button-div'>\n        <button class='btn-base sim'>Sim</button>\n        <button class='btn-base nao'>Não</button>\n      </div>\n    `),document.getElementById("mensagens-genericas").addEventListener("click",importarPlanidHandler)):"edicao"!==e&&planid.ultimoRegistrado||(document.querySelector("body").insertAdjacentHTML("beforeend",relatorioBase(dashboard.csrfToken,dashboard.user._id)),document.querySelector(".overlay-novo-planid").insertAdjacentHTML("beforeend",divNavegacaoPlanid),variaveisGlobais.controlarVisibilidade("exibir",".overlay-novo-planid"),document.querySelectorAll("body")[0].classList.add("fixo"),planid.totalPaginas=document.querySelectorAll(".section-planid").length,document.getElementById("planid-formulario").addEventListener("submit",submeterPlanid),listenersPlanid())},preventSubmitHandler=e=>{13===e.keyCode&&e.preventDefault()},listenersPlanid=()=>{document.querySelector(".div-navegacao-planid").addEventListener("click",navegacaoPlanid),document.querySelector(".button-fechar").addEventListener("click",deveSalvarPlanidAoFechar),document.getElementById("planid-formulario").addEventListener("click",checarCampoVazio),document.getElementById("planid-formulario").addEventListener("keyup",checarCampoVazio),document.getElementById("planid-formulario").addEventListener("keypress",preventSubmitHandler),document.getElementById("planid-formulario").addEventListener("click",generalClickHandler),document.getElementById("planid-formulario").addEventListener("change",e=>calcularCargaHorariaTotal(e)),document.getElementById("planid-formulario").addEventListener("change",e=>calcularCargaHorariaParcial(e)),document.querySelector(".form-steps").addEventListener("click",stepsHandler),document.querySelector(".alerta-nao-preenchidos").addEventListener("click",iconeNaoPreenchidosHandler),listenersBotoesFormulario()},recuperarDadosPlanidOffline=(e,a)=>{const i=JSON.parse(JSON.parse(e).dados);i._id=JSON.parse(e).idPlanid,i.autor=i.autor[0],i.semestre=i.semestre[0],i.comentariosGerais=i.comentariosGerais[0],a=i,selecionarDadosVersao(a.semestre),setTimeout(()=>{for(let e=0;e<dashboard.user.planids.length;e++)if(dashboard.user.planids[e]._id===a._id){dashboard.user.planids[e]={...gerarPlanidEmBranco(),...a};break}},500)},selecionarFonteDados=(e,a,i,o)=>{e.target.dataset.value?"local"===e.target.dataset.value&&recuperarDadosPlanidOffline(a,i):e.target.classList.contains("icone-fechar-janela")&&"local"===o&&recuperarDadosPlanidOffline(a,i),variaveisGlobais.controlarVisibilidade("ocultar","#mensagens-genericas")},gerarListaPlanids=()=>{let e="";const a=localStorage.getItem("planidSalvo");if(dashboard.user.planids.length||a){e="    \n    <div class='objetos-registrados'>\n      <h3>Planids registrados:</h3>\n      <div class='objetos-registrados__container'>\n    ";for(let i=0;i<dashboard.user.planids.length;i++){const o=planid.ultimoRegistrado._id===dashboard.user.planids[i]._id;let n,s,t=dashboard.user.planids[i];if(!planid.exibiuAlertaDadosOffline&&a&&JSON.parse(a).idPlanid===t._id){const e=t.dataDeEdicao,i=JSON.parse(JSON.parse(localStorage.getItem("planidSalvo")).dados),o=i.dataDeEdicao;let n=`<h3>Detectamos que há dados salvos do planid ${i.semestre} neste dispositivo. `;n+=e>o?"Os dados salvos no servidor, no entanto, são mais atuais. ":"Os dados do dispositivo são mais atuais em relação àqueles salvos no servidor. ",n+="\n          Assim, deseja recuperar os dados de qual fonte?</h3>\n          <div class='button-div'>\n            <button data-value='local'>Dispositivo</button>\n            <button data-value='server'>Servidor</button>\n          </div>          \n          <h3>Se optar por fechar esta janela, os dados mais recentes serão carregados. Em caso de dúvidas, entre em contato com a <a target=\"_blank\" href='/fale-conosco?form=reportar-problema'>Assessoria de Desenvovimento Web da Decania do CCS</a></h3>\n        ";const s=e>o?"server":"local";variaveisGlobais.exibirMensagem(n),document.querySelector("#mensagens-genericas").addEventListener("click",e=>selecionarFonteDados(e,a,t,s)),planid.exibiuAlertaDadosOffline=!0}t.enviado?(n="fa-check",s="planid enviado"):(n="fa-pencil",s="planid em preenchimento");const r=o?`\n          <i class='fa fa-commenting-o icone-exibir-comentarios icone-acoes-planid' data-planid='${t._id}' title='comentários gerais sobre o planid ${t.semestre}'></i>\n          <a href='/acompanhar-eventos/planid/${t.autor}/${t._id}' target='_blank' rel='noopener' rel='noreferrer'><i class='fa fa-envelope icone-exibir-mensagens icone-acoes-planid' title='eventos e mensagens do planid ${t.semestre}'></i></a>\n        `:"";e+=`\n        <div class='objetos-registrados__objeto-registrado'>\n          <i title="${s}" class='fa fa-fw ${n} objetos-registrados__icon' ${t.enviado?"":`data-id="${t._id}"`}></i>\n          <span class='${o?"objetos-registrados__link":""}' data-id='${o?t._id:""}' title='${o?"editar o":""} planid ${t.semestre}'>Planid ${t.semestre}</span>\n          <div class='icone-acoes-planid-div'>\n            ${r}\n            <i class='fa fa-print icone-imprimir-planid icone-acoes-planid' data-imprimir='${t._id}' data-semestre='${t.semestre}' title='imprimir o planid ${t.semestre}'></i>\n          </div>\n        </div>\n      `}e+=`</div>\n      ${adicionarObjBtn("adicionar plano","botao-novo-planid")}\n      </div>\n    `}const i=`\n    <h3 class='centralizado sem-relatorios text-shadow-inset'>\n      Não há registros de Planos. Para iniciar o preenchimento, clique em "adicionar plano"\n    </h3>\n    ${adicionarObjBtn("adicionar plano","botao-novo-planid-primeiro")}\n  `;return dashboard.user.planids.length?e:planid.habilitarNovoPlanid?i:"\n    <h3 class='centralizado sem-relatorios text-shadow-inset'>\n      Está encerrado o prazo para o preenchimento de novos planids. Por gentileza, retorne quando a Decania do CCS anunciar novo período.\n    </h3>\n  "},gestaoPlanid=()=>{let e;return e='<h2 class="dashboard-section__titulo-secao">Plano Individual Docente Semestral</h2>',e+=gerarListaPlanids()},todosPlanidsEnviados=()=>{let e=!0;for(let a=0;a<dashboard.user.planids.length;a++)dashboard.user.planids[a].enviado||(e=!1);return e},inicializarVariaveis=()=>{dashboard.user.planids.length?(planid.ultimoRegistrado=dashboard.user.planids[0],planid.habilitarNovoPlanid=todosPlanidsEnviados()&&!dashboard.user.planids.find(e=>e.semestre===proximoSemestre)&&prazoNovoPlanid):planid.habilitarNovoPlanid=prazoNovoPlanid,planid.unidadePreenchimentoPlanid=dashboard.user[dashboard.user.unidadePreenchimentoPlanid]},formarArrayDisciplinas=e=>{const a=[];for(let i=0;i<e.length;i++)a.push(`${e[i].nome} -- ${e[i].codigo} -- ${e[i].nivel}`);return a},deveExibirTutorial=()=>{variaveisGlobais.exibirMensagem("\n    <h3>Deseja exibir o guia rápido de preenchimento do Planid CCS?</h3>\n    <div class='button-div'>\n      <button class='sim'>Sim</button>\n      <button class='nao'>Não</button>      \n    </div>\n  "),document.getElementById("mensagens-genericas").addEventListener("click",e=>{e.target.classList.contains("sim")?(variaveisGlobais.controlarVisibilidade("ocultar","#mensagens-genericas"),setTimeout(()=>{exibirTutorialPreenchimento()},750)):variaveisGlobais.exibirMensagem('<h3>Para exibir o guia a qualquer momento, clique sobre <strong>"exibir tutorial"</strong> no canto inferior direito da interface dos sistemas.</h3>')})},montarAreaPlanid=async()=>{document.querySelector(".dashboard-section__aplicacoes-body").innerHTML=gestaoPlanid(),document.querySelector(".botao-novo-planid-primeiro")&&document.querySelector(".botao-novo-planid-primeiro").addEventListener("click",()=>rotinasNovoPlanid(semestre)),document.querySelector(".objetos-registrados")&&document.querySelector(".objetos-registrados").addEventListener("click",e=>planidsClickHandler(e)),planid.exibiuTutorial||localStorage.getItem("ocultarTutorialPreenchimentoPlanid")||localStorage.getItem("planidSalvo")||(planid.exibiuTutorial=!0,variaveisGlobais.exibirMensagem("\n    <h3>Deseja exibir o guia rápido de preenchimento do Planid CCS?</h3>\n    <div class='button-div'>\n      <button class='sim'>Sim</button>\n      <button class='nao'>Não</button>      \n    </div>\n  "),document.getElementById("mensagens-genericas").addEventListener("click",e=>{e.target.classList.contains("sim")?(variaveisGlobais.controlarVisibilidade("ocultar","#mensagens-genericas"),setTimeout(()=>{exibirTutorialPreenchimento()},750)):variaveisGlobais.exibirMensagem('<h3>Para exibir o guia a qualquer momento, clique sobre <strong>"exibir tutorial"</strong> no canto inferior direito da interface dos sistemas.</h3>')})),document.querySelector(".dashboard-section__aplicacoes-body").insertAdjacentHTML("beforeend",'<span class="tutorial-planid__exibir-tutorial">exibir tutorial</span>'),document.querySelector(".tutorial-planid__exibir-tutorial").addEventListener("click",exibirTutorialPreenchimento)},rotinasPlanid=()=>{dashboard.user.planids.length?(planid.ultimoRegistrado=dashboard.user.planids[0],planid.habilitarNovoPlanid=todosPlanidsEnviados()&&!dashboard.user.planids.find(e=>e.semestre===proximoSemestre)&&prazoNovoPlanid):planid.habilitarNovoPlanid=prazoNovoPlanid,planid.unidadePreenchimentoPlanid=dashboard.user[dashboard.user.unidadePreenchimentoPlanid],montarAreaPlanid()};